<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallet - CRYPBIT</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="wallet.css">
    <script src="script.js" defer></script>
</head>
<header class="site-header">
    <div class="logo-container">
      <img src="image-removebg-preview.png" alt="Logo" />
    </div>
  
    <!-- Hamburger Menu -->
    <div class="hamburger-menu" id="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  
    <!-- Mobile Navigation Menu -->
    <nav class="mobile-navigation" id="mobileNav">
      <ul class="nav-list">
        <li class="nav-item">
          <a href="index.html" class="nav-link">Home</a>
        </li>
        <li class="nav-item">
          <a href="about.html" class="nav-link">News</a>
        </li>
        <li class="nav-item">
          <a href="wallet.html" class="nav-link">Wallet</a>
        </li>
        <li class="nav-item">
          <a href="support.html" class="nav-link">Support</a>
        </li>
        <li class="nav-item">
            <a href="login.html" class="nav-link">Log out</a>
          </li>
      </ul>
    </nav>
  </header>
  

<body>
    <section class="wallet-section">
      <div class="wallet-info">
        <p class="wallet-address">
            Wallet Address: <span id="walletAddress">Loading...</span>
        </p>
        <h2>BALANCE</h2>
        <div class="balance-item">
            <span>USDC:</span>
            <span id="balance-usdc">0.00000</span>
        </div>
        <div class="balance-item">
            <span>SOL:</span>
            <span id="balance-sol">0.00000</span>
        </div>
        <div class="balance-item">
            <span>BTC:</span>
            <span id="balance-btc">0.00000</span>
        </div>
        <div class="balance-item">
            <span>ETH:</span>
            <span id="balance-eth">0.00000</span>
        </div>
        <!-- The button dynamically changes -->
        <button id="actionBtn" class="connect-btn">Loading...</button>
    </div>
    
    
    </section>

    <script>
document.addEventListener("DOMContentLoaded", function () {
    // Fetch wallet balances and wallet address
    fetch("get_wallet_balances.php")
        .then((response) => response.json())
        .then((data) => {
            if (data.success) {
                // Update wallet address
                document.getElementById("walletAddress").textContent = data.wallet.wallet_address;

                // Update wallet balances
                document.getElementById("balance-usdc").textContent = parseFloat(data.wallet.balance_usdc).toFixed(5);
                document.getElementById("balance-sol").textContent = parseFloat(data.wallet.balance_sol).toFixed(5);
                document.getElementById("balance-btc").textContent = parseFloat(data.wallet.balance_btc).toFixed(5);
                document.getElementById("balance-eth").textContent = parseFloat(data.wallet.balance_eth).toFixed(5);

                // Change the button to "Trade" and redirect to the home page
                const actionBtn = document.getElementById("actionBtn");
                actionBtn.textContent = "Trade";
                actionBtn.addEventListener("click", function () {
                    window.location.href = "index.html"; // Redirect to the home page for swapping
                });
            } else {
                console.error("Error:", data.message);
                alert(data.message || "Failed to fetch wallet balances.");

                // If no wallet found, change the button to "Logout"
                const actionBtn = document.getElementById("actionBtn");
                actionBtn.textContent = "Logout";
                actionBtn.addEventListener("click", function () {
                    fetch("logout.php", { method: "POST" })
                        .then(() => {
                            window.location.href = "login.html"; // Redirect to login page
                        })
                        .catch(error => console.error("Error logging out:", error));
                });
            }
        })
        .catch((error) => {
            console.error("Error fetching wallet balances:", error);
            alert("An error occurred while fetching wallet balances.");

            // Handle logout if fetch fails
            const actionBtn = document.getElementById("actionBtn");
            actionBtn.textContent = "Logout";
            actionBtn.addEventListener("click", function () {
                fetch("logout.php", { method: "POST" })
                    .then(() => {
                        window.location.href = "login.html"; // Redirect to login page
                    })
                    .catch(error => console.error("Error logging out:", error));
            });
        });
});




        // Logout functionality
        document.getElementById("logoutBtn").addEventListener("click", function () {
            fetch("logout.php", { method: "POST" })
                .then(() => {
                    window.location.href = "login.html";
                })
                .catch(error => {
                    console.error("Error logging out:", error);
                    alert("An error occurred while logging out.");
                });
        });
    </script>
</body>
</html>
